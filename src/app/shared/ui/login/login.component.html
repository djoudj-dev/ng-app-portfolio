<div
  role="dialog"
  aria-labelledby="login-modal-title"
  (click)="$event.stopPropagation()"
  data-login-modal
  [class]="
    isCompact()
      ? 'p-2'
      : 'fixed z-50 w-[400px] rounded-lg border border-accent-400 bg-background p-5 shadow-xl animate-fadeIn'
  "
  [style.top.px]="!isCompact() ? position().top : null"
  [style.left.px]="!isCompact() ? position().left : null"
>
  <div [class]="isCompact() ? 'mb-3' : 'mb-4'">
    <div class="flex justify-between items-center">
      <h2
        id="login-modal-title"
        [class]="isCompact() ? 'text-sm font-semibold text-text' : 'text-lg font-semibold text-text'"
      >
        Connexion
      </h2>
      <button
        type="button"
        aria-label="Fermer"
        (click)="close()"
        class="p-1 rounded-full hover:bg-accent-400 transition-colors"
      >
        <img
          [ngSrc]="'icons/navbar/close.svg'"
          alt="Fermer"
          [width]="isCompact() ? 12 : 16"
          [height]="isCompact() ? 12 : 16"
          [class]="isCompact() ? 'w-3 h-3 icon-invert' : 'w-4 h-4 icon-invert'"
        />
      </button>
    </div>
    <p [class]="isCompact() ? 'text-xs text-muted' : 'mt-1 text-sm text-muted'">Espace réservé au grand barbu !!</p>
  </div>

  <form (submit)="$event.preventDefault(); login()">
    <div class="mb-4">
      <label [for]="'email-' + formId" class="block text-sm font-medium text-text mb-1">Email</label>
      <input
        type="text"
        [id]="'email-' + formId"
        [value]="formService.email()"
        (input)="onEmailInput($event)"
        class="w-full px-3 py-2 border border-accent-400 rounded-md bg-background text-text focus:outline-none focus:ring-2 focus:ring-accent-500"
        required
      />
    </div>

    <div class="mb-4">
      <label [for]="'password-' + formId" class="block text-sm font-medium text-text mb-1">Mot de passe</label>
      <div class="relative">
        <input
          [type]="formService.passwordVisible() ? 'text' : 'password'"
          [id]="'password-' + formId"
          [value]="formService.password()"
          (input)="onPasswordInput($event)"
          class="w-full px-3 py-2 border border-accent-400 rounded-md bg-background text-text focus:outline-none focus:ring-2 focus:ring-accent-500 pr-10"
          required
        />
        <button
          type="button"
          (click)="formService.togglePasswordVisibility()"
          class="absolute inset-y-0 right-0 pr-3 flex items-center"
          aria-label="Afficher / cacher le mot de passe"
        >
          <img
            [ngSrc]="formService.passwordVisible() ? 'icons/navbar/invisibility.svg' : 'icons/navbar/visibility.svg'"
            alt="Afficher / Cacher"
            width="20"
            height="20"
            class="w-5 h-5 icon-invert"
          />
        </button>
      </div>
    </div>

    <div class="flex justify-between items-center mb-4">
      <div class="flex items-center">
        <input
          type="checkbox"
          [id]="'remember-me-' + formId"
          [checked]="formService.rememberMe()"
          (change)="onRememberChange($event)"
          class="h-4 w-4 text-accent-500 border-accent-300 rounded"
        />
        <label [for]="'remember-me-' + formId" class="ml-2 block text-sm text-text"> Se souvenir de moi </label>
      </div>
      <button type="button" (click)="forgotPassword()" class="text-sm text-accent-500 hover:underline">
        Mot de passe oublié?
      </button>
    </div>

    @if (formService.errorMessage(); as error) {
      <div class="mb-4 p-2 bg-red-100 border border-red-400 text-red-700 rounded">
        {{ error }}
      </div>
    }

    <button
      type="submit"
      [disabled]="formService.isLoading()"
      class="w-full bg-accent-500 text-white py-2 px-4 rounded-md hover:bg-accent-600 transition-colors focus:outline-none focus:ring-2 focus:ring-accent-400 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
    >
      @if (formService.isLoading()) {
        <svg
          class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
        >
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
        Connexion...
      } @else {
        Se connecter
      }
    </button>
  </form>
</div>
