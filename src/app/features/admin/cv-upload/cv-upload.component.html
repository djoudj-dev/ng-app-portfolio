<div
  class="border border-gray-400 rounded-xl p-6 bg-background shadow-md transition duration-300 hover:shadow-lg w-full"
>
  <h2 class="text-xl font-semibold text-text mb-4 flex items-center gap-2">
    <img [ngSrc]="'icons/upload.svg'" alt="Upload Icon" class="w-6 h-6" height="24" width="24" />
    Uploader un CV
  </h2>

  <!-- CV existant -->
  <div class="mb-6 p-4 border border-primary-200 rounded-lg bg-primary-50">
    <h3 class="text-lg font-medium text-text mb-2">CV actuel</h3>
    <div class="flex items-center justify-between">
      <p class="text-secondary-700">{{ cvPath }}</p>
      <button
        type="button"
        class="bg-primary-500 text-white px-3 py-1 rounded hover:bg-primary-600 transition-colors flex items-center gap-1"
        (click)="viewExistingCV()"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
          />
        </svg>
        Voir
      </button>
    </div>
  </div>

  <!-- ✅ Affichage erreurs -->
  @if (uploadError()) {
    <div class="bg-red-100 text-red-700 p-3 rounded mb-4 text-sm">
      {{ uploadError() }}
    </div>
  }

  <!-- ✅ Message succès -->
  @if (success()) {
    <div class="bg-green-100 text-green-700 p-3 rounded mb-4 text-sm">
      {{ success() }}
    </div>
  }

  <!-- ✅ Message en cours -->
  @if (isUploading()) {
    <div class="flex items-center justify-center bg-accent-50 p-3 rounded mb-4 text-sm">
      <img
        [ngSrc]="'icons/spinner.svg'"
        class="animate-spin -ml-1 mr-3 h-5 w-5 text-accent"
        alt="Loading spinner"
        height="20"
        width="20"
      />
      <span class="text-accent-600">Chargement en cours...</span>
    </div>
  }

  <!-- ✅ Zone cliquable avec drag & drop -->
  <div
    class="w-full border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors duration-200"
    [class.border-accent]="isDragging()"
    [class.bg-accent-50]="isDragging()"
    [class.border-primary-300]="!isDragging()"
    [class.bg-primary-50]="!isDragging()"
    [class.hover:border-accent]="!isDragging()"
    role="button"
    tabindex="0"
    aria-label="Uploader un CV"
    (click)="$event.stopPropagation(); openFilePicker()"
    (keydown.enter)="openFilePicker()"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <!-- ✅ Input file accessible -->
    <input
      type="file"
      accept=".pdf,.doc,.docx"
      class="hidden"
      #fileInput
      (change)="onFileSelected($event)"
      (click)="logFileInputClick()"
    />

    <!-- Dedicated upload button -->
    <button
      type="button"
      class="bg-accent text-white px-4 py-2 rounded-md mb-4 hover:bg-accent-600 transition-colors"
      (click)="$event.stopPropagation(); openFilePicker()"
    >
      Sélectionner un fichier
    </button>

    <!-- ✅ Affichage conditionnel -->
    @if (!uploadedFile()) {
      <div class="flex flex-col items-center justify-center space-y-2">
        <img [ngSrc]="'icons/upload.svg'" alt="Upload Icon" class="w-6 h-6" height="24" width="24" />
        <p class="text-text font-medium">Glissez votre CV ici ou cliquez pour le sélectionner</p>
        <p class="text-sm text-secondary-500">Formats acceptés : PDF, DOC, DOCX · max 5MB</p>
      </div>
    } @else {
      <div class="flex items-center justify-between mt-4">
        <div>
          <p class="text-text font-medium">{{ uploadedFile()!.name }}</p>
          <p class="text-xs text-secondary-500">{{ uploadedFile()!.size / 1000 | number: '1.0-0' }} Ko</p>
        </div>
        <button
          type="button"
          class="text-red-500 text-sm underline hover:text-red-700 transition"
          (click)="removeFile()"
        >
          Supprimer
        </button>
      </div>
    }
  </div>
</div>
