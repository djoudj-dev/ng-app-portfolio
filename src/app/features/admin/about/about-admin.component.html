<div class="container mx-auto p-6 pt-18">
  <header class="mb-8">
    <h1 class="text-3xl font-bold text-primary-600 mb-2">Gestion de la section À propos</h1>
    <p class="text-secondary-500">Modifiez les informations de la section À propos de votre portfolio.</p>
  </header>

  <!-- Loading state -->
  @if (loading()) {
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent"></div>
    </div>
  }

  <!-- Error message -->
  @if (error()) {
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-md" role="alert">
      <p class="font-bold">Erreur</p>
      <p>{{ error() }}</p>
    </div>
  }

  <!-- Success message -->
  @if (success()) {
    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-md" role="alert">
      <p class="font-bold">Succès</p>
      <p>{{ success() }}</p>
    </div>
  }

  <!-- About Form -->
  <form
    [formGroup]="aboutForm"
    (ngSubmit)="saveAbout()"
    class="bg-background border border-primary-200 rounded-lg shadow-primary-md p-6"
  >
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Full Name -->
      <div class="form-group">
        <label for="fullname" class="block text-text font-medium mb-2">Nom complet</label>
        <input
          type="text"
          id="fullname"
          formControlName="fullname"
          class="w-full px-4 py-2 border border-primary-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-400 bg-background text-text"
          [ngClass]="{ 'border-red-500': aboutForm.get('fullname')?.invalid && aboutForm.get('fullname')?.touched }"
        />
        @if (aboutForm.get('fullname')?.invalid && aboutForm.get('fullname')?.touched) {
          <p class="text-red-500 text-sm mt-1">Le nom complet est requis.</p>
        }
      </div>

      <!-- Title -->
      <div class="form-group">
        <label for="title" class="block text-text font-medium mb-2">Titre</label>
        <input
          type="text"
          id="title"
          formControlName="title"
          class="w-full px-4 py-2 border border-primary-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-400 bg-background text-text"
          [ngClass]="{ 'border-red-500': aboutForm.get('title')?.invalid && aboutForm.get('title')?.touched }"
        />
        @if (aboutForm.get('title')?.invalid && aboutForm.get('title')?.touched) {
          <p class="text-red-500 text-sm mt-1">Le titre est requis.</p>
        }
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Location -->
      <div class="form-group">
        <label for="location" class="block text-text font-medium mb-2">Localisation</label>
        <input
          type="text"
          id="location"
          formControlName="location"
          class="w-full px-4 py-2 border border-primary-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-400 bg-background text-text"
          [ngClass]="{ 'border-red-500': aboutForm.get('location')?.invalid && aboutForm.get('location')?.touched }"
        />
        @if (aboutForm.get('location')?.invalid && aboutForm.get('location')?.touched) {
          <p class="text-red-500 text-sm mt-1">La localisation est requise.</p>
        }
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email" class="block text-text font-medium mb-2">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="w-full px-4 py-2 border border-primary-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-400 bg-background text-text"
          [ngClass]="{ 'border-red-500': aboutForm.get('email')?.invalid && aboutForm.get('email')?.touched }"
        />
        @if (aboutForm.get('email')?.invalid && aboutForm.get('email')?.touched) {
          <div class="text-red-500 text-sm mt-1">
            @if (aboutForm.get('email')?.errors?.['required']) {
              <p>L'email est requis.</p>
            }
            @if (aboutForm.get('email')?.errors?.['email']) {
              <p>Veuillez entrer une adresse email valide.</p>
            }
          </div>
        }
      </div>
    </div>

    <!-- Description -->
    <div class="form-group mb-6">
      <label for="description" class="block text-text font-medium mb-2">Description</label>
      <textarea
        id="description"
        formControlName="description"
        rows="4"
        class="w-full px-4 py-2 border border-primary-300 rounded-md focus:outline-none focus:ring-2 focus:ring-accent-400 bg-background text-text"
        [ngClass]="{
          'border-red-500': aboutForm.get('description')?.invalid && aboutForm.get('description')?.touched,
        }"
      ></textarea>
      @if (aboutForm.get('description')?.invalid && aboutForm.get('description')?.touched) {
        <div class="text-red-500 text-sm mt-1">
          @if (aboutForm.get('description')?.errors?.['required']) {
            <p>La description est requise.</p>
          }
          @if (aboutForm.get('description')?.errors?.['maxlength']) {
            <p>La description ne doit pas dépasser 1000 caractères.</p>
          }
        </div>
      }
      <div class="text-secondary-500 text-sm mt-1">
        {{ aboutForm.get('description')?.value?.length || 0 }}/1000 caractères
      </div>
    </div>

    <!-- Image Upload -->
    <div class="form-group mb-8">
      <label for="imageUpload" class="block text-text font-medium mb-2">Image de profil</label>

      <!-- Hidden input for image path -->
      <input type="hidden" id="imageUrl" formControlName="imageUrl" />

      <!-- File upload area -->
      <div
        class="border-2 border-dashed border-primary-300 rounded-md p-6 text-center cursor-pointer hover:border-accent transition-colors"
        [ngClass]="{
          'border-red-500': aboutForm.get('imageUrl')?.invalid && aboutForm.get('imageUrl')?.touched,
          'bg-primary-50': isDragging(),
          'border-accent': isDragging(),
        }"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (click)="fileInput.click()"
      >
        <input
          #fileInput
          type="file"
          id="imageUpload"
          class="hidden"
          accept=".jpg,.jpeg,.png,.gif,.webp"
          (change)="onFileSelected($event)"
        />

        @if (!uploadedFile() && !aboutForm.get('imageUrl')?.value) {
          <div class="flex flex-col items-center justify-center">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-12 w-12 text-primary-400 mb-3"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <p class="text-primary-600 font-medium">Glissez et déposez votre image ici</p>
            <p class="text-secondary-500 text-sm mt-1">ou cliquez pour sélectionner un fichier</p>
            <p class="text-secondary-500 text-xs mt-2">Formats acceptés: JPEG, PNG, GIF, WEBP (max 5MB)</p>
          </div>
        } @else {
          <div class="flex flex-col items-center justify-center">
            <!-- Image preview -->
            <div class="mb-3">
              <div class="w-32 h-32 border border-primary-200 rounded-md overflow-hidden">
                <img
                  [src]="getSafeUrl(aboutForm.get('imageUrl')?.value)"
                  alt="Image preview"
                  class="w-full h-full object-cover"
                />
              </div>
            </div>

            <p class="text-primary-600 font-medium">
              {{ uploadedFile() ? uploadedFile()!.name : getFileNameFromPath(aboutForm.get('imageUrl')?.value) }}
            </p>
            <p class="text-secondary-500 text-sm mt-1">
              {{ uploadedFile() ? (uploadedFile()!.size | fileSize) : 'Fichier déjà téléchargé' }}
            </p>
            <app-button
              type="button"
              color="secondary"
              (buttonClick)="removeFile($event)"
              customClass="mt-3 px-3 py-1 text-sm"
            >
              Supprimer
            </app-button>
          </div>
        }
      </div>

      @if (aboutForm.get('imageUrl')?.invalid && aboutForm.get('imageUrl')?.touched) {
        <p class="text-red-500 text-sm mt-1">L'image est requise.</p>
      }

      @if (uploadError()) {
        <p class="text-red-500 text-sm mt-1">{{ uploadError() }}</p>
      }
    </div>

    <!-- Form Actions -->
    <div class="flex flex-col sm:flex-row justify-end gap-4">
      <app-button type="button" color="secondary" (buttonClick)="resetForm()" customClass="mt-6 px-6 py-1 text-sm">
        Annuler
      </app-button>
      <app-button
        type="submit"
        color="accent"
        [disabled]="aboutForm.invalid || loading()"
        [isLoading]="loading()"
        customClass="mt-6 px-6 py-1 text-sm"
      >
        Enregistrer
      </app-button>
    </div>
  </form>
</div>
